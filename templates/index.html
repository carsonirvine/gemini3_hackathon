<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UVic Course Lookup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Modern Spinner Animation */
        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #3b82f6;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-12 px-4">

    <div class="w-full max-w-2xl bg-white shadow-2xl rounded-3xl p-8">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-2 text-center">UVic Course Lookup</h1>
        <p class="text-gray-500 text-center mb-8">Real-time seat and schedule scraper</p>
        
        <div class="flex gap-3 mb-8">
            <input type="text" id="subjectInput" placeholder="Subject (e.g. CSC)" 
                class="flex-1 px-5 py-4 border-2 border-gray-200 rounded-2xl focus:border-blue-500 focus:ring-0 outline-none uppercase font-semibold transition-all">
            <button onclick="startScrape()" id="btn"
                class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-4 rounded-2xl font-bold shadow-lg shadow-blue-200 transition-all active:scale-95">
                Fetch
            </button>
        </div>

        <div id="status" class="hidden mb-6 p-4 rounded-xl text-center font-semibold"></div>

        <div id="results" class="space-y-4"></div>
    </div>

    <script>
        // Colors for Seat/Waitlist Availability
        function getStatusColor(fraction) {
            if (!fraction || fraction === "N/A") return "text-gray-500 bg-gray-100 border-gray-200";
            const [rem, total] = fraction.split('/').map(Number);
            if (total === 0 || rem === 0) return "text-red-700 bg-red-50 border-red-200";
            const percentLeft = (rem / total) * 100;
            if (percentLeft >= 25) return "text-emerald-700 bg-emerald-50 border-emerald-200";
            if (percentLeft > 0) return "text-amber-700 bg-amber-50 border-amber-200";
            return "text-red-700 bg-red-50 border-red-200";
        }

        // Colors for Section Type (Lecture, Lab, Tutorial)
        function getSectionTheme(section) {
            const char = section.charAt(0).toUpperCase();
            if (char === 'B') return { label: "LAB", border: "border-purple-500", bg: "bg-purple-50", text: "text-purple-700" };
            if (char === 'T') return { label: "TUTORIAL", border: "border-orange-500", bg: "bg-orange-50", text: "text-orange-700" };
            return { label: "LECTURE", border: "border-green-500", bg: "bg-green-50", text: "text-green-700" };
        }

        // Colors for Instructional Method
        function getMethodTheme(method) {
            const m = method || "";
            if (m.includes('Face-to-face')) return "bg-blue-100 text-blue-700 border-blue-200";
            if (m.includes('Fully Online')) return "bg-purple-100 text-purple-700 border-purple-200";
            if (m.includes('Blended')) return "bg-indigo-100 text-indigo-700 border-indigo-200";
            if (m.includes('Online with some')) return "bg-cyan-100 text-cyan-700 border-cyan-200";
            return "bg-gray-100 text-gray-700 border-gray-200";
        }

        async function startScrape() {
            const subject = document.getElementById('subjectInput').value;
            const btn = document.getElementById('btn');
            const status = document.getElementById('status');
            const resultsDiv = document.getElementById('results');

            if (!subject) return alert("Please enter a subject");

            btn.disabled = true;
            btn.innerText = "Working...";
            resultsDiv.innerHTML = "";
            status.className = "mb-6 p-4 rounded-xl text-center font-semibold bg-blue-50 text-blue-700 block animate-pulse";
            status.innerHTML = `<div class="spinner"></div> <span>Searching all pages for ${subject.toUpperCase()}...</span>`;

            try {
                const response = await fetch('/scrape', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ subject: subject.toUpperCase() })
                });
                
                const result = await response.json();
                
                if (result.status === "success") {
                    status.className = "mb-6 p-4 rounded-xl text-center font-semibold bg-emerald-50 text-emerald-700";
                    status.innerHTML = `
                        <div>Successfully loaded ${result.data.length} sections</div>
                        <div class="text-[10px] uppercase tracking-widest mt-1 opacity-70">Search completed in ${result.search_time}s</div>
                    `;
                    
                    result.data.forEach(course => {
                        const seatColor = getStatusColor(course.seats);
                        const waitColor = getStatusColor(course.waitlist);
                        const theme = getSectionTheme(course.section);
                        const methodTheme = getMethodTheme(course.instructionalMethod);

                        const card = document.createElement('div');
                        card.className = `border-l-8 ${theme.border} bg-white p-6 rounded-2xl shadow-sm border border-gray-100`;
                        card.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="flex flex-wrap items-center gap-2 mb-1">
                                        <span class="text-[10px] font-black px-2 py-0.5 rounded border-2 ${theme.border} ${theme.bg} ${theme.text} uppercase tracking-widest leading-tight">
                                            ${theme.label}
                                        </span>
                                        <span class="text-[10px] font-bold px-2 py-0.5 rounded border ${methodTheme} uppercase tracking-wide">
                                            ${course.instructionalMethod || 'Standard'}
                                        </span>
                                        <h3 class="font-bold text-xl text-gray-900">${course.subject} ${course.course}</h3>
                                    </div>
                                    <p class="text-sm font-bold text-gray-400 uppercase tracking-tighter">Section ${course.section} â€¢ CRN ${course.crn}</p>
                                </div>
                                <div class="flex flex-col gap-2 items-end">
                                    <div class="flex flex-col items-end">
                                        <span class="text-[9px] uppercase font-bold text-gray-400 mr-1">Available Seats</span>
                                        <span class="px-3 py-1 rounded-lg text-sm font-bold border ${seatColor}">${course.seats}</span>
                                    </div>
                                    <div class="flex flex-col items-end">
                                        <span class="text-[9px] uppercase font-bold text-gray-400 mr-1">Waitlist</span>
                                        <span class="px-3 py-1 rounded-lg text-sm font-bold border ${waitColor}">${course.waitlist}</span>
                                    </div>
                                </div>
                            </div>
                            <h4 class="text-gray-700 font-medium mt-3 leading-tight">${course.title}</h4>
                            <div class="flex items-center text-sm font-semibold text-gray-500 mt-4 bg-gray-50 p-3 rounded-xl border border-gray-100">
                                <span class="mr-2">ðŸ“…</span> ${course.schedule}
                            </div>
                        `;
                        resultsDiv.appendChild(card);
                    });
                } else {
                    throw new Error(result.message);
                }
            } catch (err) {
                status.className = "mb-6 p-4 rounded-xl text-center font-semibold bg-red-50 text-red-700";
                status.innerText = "Error: " + err.message;
            } finally {
                btn.disabled = false;
                btn.innerText = "Fetch";
            }
        }
    </script>
</body>
</html>